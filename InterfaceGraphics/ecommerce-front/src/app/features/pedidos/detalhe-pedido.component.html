<div class="page-container" *ngIf="!carregando(); else loading">
  
  <button class="btn-back" (click)="voltar()">
    ← Voltar
  </button>

  <header class="pedido-header">
    <div class="info-main">
      <h1>Pedido #{{ pedido().id }}</h1>
      <span class="data">Realizado em {{ pedido().dataCadastro | date:'dd/MM/yyyy HH:mm' }}</span>
    </div>
    <div class="status-badge" [attr.data-status]="pedido().statusId">
      {{ pedido().status }}
    </div>
  </header>

  <section class="timeline-section">
    <app-pedido-timeline [statusAtual]="pedido().statusId"></app-pedido-timeline>
  </section>

  <div class="content-grid">
    <div class="card itens-card">
      <h3>Resumo do Pedido</h3>
      <div class="lista-produtos">
        <div *ngFor="let item of pedido().itens" class="produto-item">
          <div class="detalhe">
            <strong>{{ item.nomeProdutoSnapshot }}</strong>
            <small>Qtd: {{ item.quantidade }}</small>
          </div>
          <div class="preco">
            {{ item.precoUnitario | currency:'BRL' }}
          </div>
        </div>
      </div>
      <div class="total-row">
        <span>Total</span>
        <span class="valor-total">{{ pedido().valorTotal | currency:'BRL' }}</span>
      </div>
    </div>

    <div class="card actions-card">
      <h3>Pagamento</h3>
      
      <div *ngIf="pedido().statusId === 1" class="payment-box">
        <p>Seu saldo: <strong>{{ saldoCarteira() | currency:'BRL' }}</strong></p>

        <button *ngIf="saldoCarteira() >= pedido().valorTotal" 
                class="btn-pagar" 
                (click)="pagarComCashback()">
          Pagar com Cashback
        </button>

        <div *ngIf="saldoCarteira() < pedido().valorTotal" class="alert-error">
          Saldo insuficiente.
        </div>
      </div>

      <div *ngIf="pedido().statusId >= 3 && pedido().statusId !== 6" class="success-box">
        ✓ Pedido Pago
      </div>

      <div *ngIf="pedido().statusId === 6" class="danger-box">
        Pedido Cancelado
      </div>

      <button *ngIf="pedido().statusId < 4 && pedido().statusId !== 6" 
              class="btn-cancelar" 
              (click)="cancelarPedido()">
        Cancelar Pedido
      </button>
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="loading-state">Carregando...</div>
</ng-template>